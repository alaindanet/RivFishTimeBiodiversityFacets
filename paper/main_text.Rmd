---
title: "Past and recent anthropogenic pressures drive community changes over space and time in riverine fish assemblages"
author: "Alain Danet, Xingli Giam, Julian Olden, Lise Comte"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  bookdown::pdf_document2:
    keep_tex: true
  bookdown::word_document2:
bibliography: "bibliography.bib"
csl: nature.csl
link-citations: true
indent: true
spacing: double
---

<!--header-includes:-->
  <!--- \usepackage[left]{lineno}-->
  <!--- \linenumbers-->
  <!--- \hypersetup{backref=true}-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      collapse = TRUE,
                      comment = "#>",
                      fig.path = "graphics/knitr-",
                      fig.retina = 1.618, # Control using dpi
                      fig.width = 6,  # generated images
                      fig.pos = "t",  # pdf mode
                      fig.align = "center",
                      dpi = if (knitr::is_latex_output()) 72 else 300,
                      out.width = "100%",
                      dev = "svg",
                      dev.args = list(png = list(type = "cairo-png")),
                      optipng = "-o1 -quiet")

library(here)
source(here::here("R", "misc.R"))
source(here::here("R", "variable_shortcut.R"))
source(here::here("R", "basic_stat.R"))
source(here::here("R", "summary_distribution.R"))
library(tidyverse)
library(magrittr)
library(cowplot)
library(targets)
library(kableExtra)


if (Sys.info()["login"] == "alain")
  file.copy(
    from = "~/Documents/post-these/references.bib",
    to = here("paper", "bibliography.bib")
  )
```

```{r load-targets, include=FALSE}
tar_load(c(site_desc_loc, measurement))
tar_load(c(modelling_data, filtered_dataset_modelling, analysis_dataset))
tar_load(filtered_op_protocol_modelling)
tar_load(c(measurement_exo, modelling_data_exo))


fnsite <- nrow(filtered_dataset_modelling$location)

measurement_exo <- measurement_exo %>%
  filter(op_id %in% unique(modelling_data_exo$op_id))

tar_load(inla_no_drivers_effects)
tar_load(c(trends, trends80, trends90))
tar_load(c(abun_trends, rich_trends, hill_trends, jac_trends, ne_trends,
    tu_trends))
abun_trends <- str_replace(abun_trends, "\\[ ", "\\[")
tar_load(c(pred_number, pred_inla, pred_data_explanation))
```
```{r}
table_to_vec <- function(x) {
  setNames(as.numeric(x), names(x))
}
get_comp <- function(
  pred = pred_number,
  type = "pred_hft93_t0",
  resp = NULL,
  lvl_comp = NULL
  ) {
  pred[[type]][[resp]][["mean"]][lvl_comp]
}
```
```{r}
tar_load(c(gaussian_inla_std_effects, gaussian_inla_exo_std_effects))
tu <- rbind(gaussian_inla_std_effects, gaussian_inla_exo_std_effects)
ci80 <- tu %>%
  filter(ci_level == "level:0.80")
ci90 <- tu %>%
  filter(ci_level == "level:0.90")
ci95 <- tu %>%
  filter(ci_level == "level:0.95")
```



```{r, results="hide"}
word_count <- wordcountaddin::text_stats(here("paper", "main_text.Rmd"))
readable <- wordcountaddin::readability(filename = here("paper", "main_text.Rmd"), quiet = TRUE)
```
```{r}
word_count
```
---
#- TODO: 
#  - [ ] Is it possible to capture the number of spliting of fish species in the
#    database? (if not available, may be prepare a mail for fishbase)
#
#- Article guidelines by Nature in Ecology and Evolution: 
#  - Main text – up to 3,500 words, excluding abstract, Methods, references and figure legends.
#  - Abstract – up to 200 words, unreferenced. 
#  - Display items – up to 6 items (figures and/or tables). 
#  - Extended Data – up to 10 items (figures and/or tables, linked from the main text in the html version of the paper).
#  - Article should be divided as follows: 
#    - Introduction (without heading, up to 500 words of referenced text on the background of the work) 
#    - Results (concise, focused account of the findings)
#    - Discussion
#    - Online Methods.
#- Results and Methods should be divided by topical subheadings; the Discussion does not contain subheadings.
#- References – as a guideline, we typically recommend up to 50.
---

\pagebreak

# Abstract (up to 200 words; now: 200)

Human pressures constitute a major driver of global biodiversity decline. Local
community responses are less clear, especially in freshwater systems where
recent increases in abundance and occupancy were reported. We analyzed a
timeseries compilation of fish abundance in riverine systems across three
biogeographic realms to quantity the effects of anthropogenic pressures on
community changes over space and time. We show that past and recent
anthropogenic pressures result in lower total abundance (-29%) while having a
proportion of non-native richness and abundance three to five times higher than
"intact" sites. We found a global increase in species richness (+13%) and in
total abundance (+7%) by decade, driven by past anthropogenic pressures,
concomitant to an increasing share of non-native species, strong species
replacement and changes in dominance, in accordance with previously reported
biotic homogenization. Past and recent anthropogenic pressures had antagonistic
effects on species richness and total abundance trends over time, but also
synergistics on increasing composition changes and non-native richness. We
further show that community trajectories are homogeneously distributed across
realms but highly heterogeneous at site scale. We highlight that linking local
community changes to reported biotic homogenization explains why reported local
gains and global declines in biodiversity are not contradictory.


# Introduction (up to 500 words / 489 words)

Whereas global diversity is reported to decline at an alarming
rate[@diaz_global_2019], local diversity shows no net change in species
richness over time in marine and terrestrial assemblages[@vellend_global_2013;
@dornelas_assemblage_2014; @blowes_geography_2019], lower declines and even
increase[@van_klink_meta-analysis_2020; @outhwaite_complex_2020]. Those
contrasting diversity trends call for further investigations to better
understand how ecological communities change at local scale.

Habitat degradation is recognised as one of the main drivers of biodiversity
losses across ecosystems[@diaz_global_2019; @caro_inconvenient_2022;
@maxwell_biodiversity_2016]. Dense urban and cultivated areas are 
associated with reduced species richness and total abundance in terrestrial
vertebrates assemblages[@newbold_global_2015] and
invertebrates[@outhwaite_agriculture_2022]. Human activities also alter
community composition by the introduction of native and non-native species by
propagule pressure and habitat disturbance[@leprieur_fish_2008;
@bernery_freshwater_2022; @villeger_homogenization_2011], which are generally
tolerant and ubiquitous species which can can cope with degraded
habitats[@tonella_importance_2018; @su_morphological_2020]. In particular,
non-native species play a disproportionate role in the recomposition of
ecological communities over time[@kuczynski_concomitant_2018;
@toussaint_historical_2014; @leprieur_fish_2008], and have dramatic effects on
assemblages when they become invasive[@gallardo_global_2016]. 
Anthropogenic pressures have therefore antagonistic effects on local diversity
because habitat degradation are expected to decrease species richness and total
abundance, while the introduction native and non-native species, are expected to
increase species richness and total abundance. 

Anthropogenic pressures are highly heterogeneous over space and time. For
instance, places such as Europe and Northeastern America are under the highest
historical human influence, i.e. in terms of cumulation of population density,
of cropland and urban areas, and built infrastructures in
general[@sanderson_human_2002]. While human influence decreased recently in
those areas, it has dramatically increased in more recently industrialized places
which are also the location of most biodiversity hotspots,
such as Southeastern America, Centralwestern Africa, South Asia and Eastern
Asia[@venter_sixteen_2016]. Take in account the spatio-temporal heterogeneities in
human pressures might then help to disentangle responses due to the legacy of
past or to recent changes in anthropogenic pressures. The multidimensional
nature of biodiversity concept[@lyashevska_how_2012; @chase_embracing_2018]
constitutes another layer of complexity in analyzing community changes, as
temporal trends in species richness can be unrelated to changes in species
composition and dominance for example[@dornelas_assemblage_2014;
@blowes_geography_2019; @scott_native_2001; @hillebrand_biodiversity_2018].
Then, a better understanding of community changes might require the use of
multiple indices which account for changes in abundance but also in species
identity.

This study addresses those research gaps by investigating the effects of both
past and recent changes in anthropogenic pressures over space and time on
riverine fish communities across several biogeographic realms. We further assess
the heterogeneity of community trajectories over space and time. Freshwater
systems constitute a timely case because human pressure are even considered to be
more dramatic. They cover a small area of terrestrial land but are also the
recipients of the pollution from byproducts of human activities
[@reid_emerging_2019], Non-native species are particularly present
[@leprieur_fish_2008] and were shown to play a disproportionate role in
homogenization of fish communities [@villeger_homogenization_2011]. Moreover,
recent reports of increase in abundance and occupancy over the last decades in
freshwater invertebrate assemblages[@van_klink_meta-analysis_2020;
@outhwaite_complex_2020], which contrasts with findings in terrestrial systems,
and calls for further investigations in freshwater systems.


# Results


```{r}
tar_load(site_year)
tss <- map(setNames(c("min", "completeness", "span"), c("min", "completeness", "span")),
  ~summary_distribution(site_year[[.x]])[c("median", "1st_quart", "2nd_quart")]
)

tss$min <- paste0(tss$min["median"], " [", tss$min["1st_quart"], ",", tss$min["2nd_quart"], "]")
tss$completeness <- round(tss$completeness * 100)
tss$completeness <- paste0(tss$completeness["median"], "% [", tss$completeness["1st_quart"], "%,", tss$completeness["2nd_quart"], "%]")
tss$span <- paste0(tss$span["median"], " [", tss$span["1st_quart"], ",", tss$span["2nd_quart"], "]")
```

```{r}
exo_trends <- map_chr(c("perc_exo_sp", "perc_exo_abun"),
  ~p_ci(trends[[.x]] * log(10 + 1), r = 3, p = FALSE)
)
names(exo_trends) <- c("perc_exo_sp", "perc_exo_abun")

exo_trends90 <- map_chr(c("perc_exo_sp", "perc_exo_abun"),
  ~p_ci(trends90[[.x]] * log(10 + 1), r = 4, p = FALSE)
)
names(exo_trends90) <- c("perc_exo_sp", "perc_exo_abun")

exo_trends80 <- map_chr(c("perc_exo_sp", "perc_exo_abun"),
  ~p_ci(trends80[[.x]] * log(10 + 1), r = 3, p = FALSE)
)
names(exo_trends80) <- c("perc_exo_sp", "perc_exo_abun")
```

```{r}
extract_pred <- function (x = NULL, resp = NULL, val_to_extract = NULL) {

  ci_low <- x[[resp]]$quant0.025[val_to_extract]
  ci_high <- x[[resp]]$quant0.975[val_to_extract]

  # Does the ci at 95 overlap? 
  ci_overlap <- ci_low[val_to_extract[1]] > ci_high[val_to_extract[2]] |
    ci_high[val_to_extract[1]] < ci_low[val_to_extract[2]]

  list(
    val = x[[resp]]$mean[val_to_extract],
    ci_overlap = !ci_overlap
  )
}
#' Get percentage of difference, the first value being the reference
get_ratio <- function(x, r = 1) {
  #reduce(x, `/`)
  out <- round((x[2] - x[1]) / x[1] * 100, r)
  paste0(out, "%")
}
```

```{r}
tar_load(pred_number)
```

```{r}
pred_hft93_t0 <- map(
  setNames(names(pred_number$pred_hft93_t0), names(pred_number$pred_hft93_t0)),
  ~extract_pred(
    x = pred_number$pred_hft93_t0,
    resp = .x,
    val_to_extract = c("intact", "max")
  )
)

abun_rich_hft93_int_max <- map_chr(
  setNames(c("log_total_abundance", "log_chao_richness"),
    c("log_total_abundance", "log_chao_richness")),
  ~ get_ratio(exp(pred_hft93_t0[[.x]]$val), r = 0)
)
other_hft93_int_max <- map_chr(
  setNames(names(pred_number$pred_hft93_t0), names(pred_number$pred_hft93_t0))[
    !names(pred_number$pred_hft93_t0) %in% c("log_chao_richness",
      "log_total_abundance")],
  ~ get_ratio(pred_hft93_t0[[.x]]$val, r = 0)
  )
```


```{r}
pred_hft9309_t0_inc <- map(
  setNames(names(pred_number$pred_hft9309_t0), names(pred_number$pred_hft9309_t0)),
  ~extract_pred(
    x = pred_number$pred_hft9309_t0,
    resp = .x,
    val_to_extract = c("0", "inc/2")
  )
)

abun_rich_hft9309_0_inc_by2 <- map_chr(
  setNames(c("log_total_abundance", "log_chao_richness"),
    c("log_total_abundance", "log_chao_richness")),
  ~ get_ratio(exp(pred_hft9309_t0_inc[[.x]]$val), r = 0)
)

other_hft9309_0_inc_by2 <- map_chr(
  setNames(names(pred_number$pred_hft9309_t0), names(pred_number$pred_hft9309_t0))[
    !names(pred_number$pred_hft9309_t0) %in% c("log_chao_richness",
      "log_total_abundance")],
  ~ get_ratio(pred_hft9309_t0_inc[[.x]]$val, r = 0)
  )

pred_hft9309_t0_dec <- map(
  setNames(names(pred_number$pred_hft9309_t0), names(pred_number$pred_hft9309_t0)),
  ~extract_pred(
    x = pred_number$pred_hft9309_t0,
    resp = .x,
    val_to_extract = c("0", "div/2")
  )
)

abun_rich_hft9309_0_dec_by2 <- map_chr(
  setNames(c("log_total_abundance", "log_chao_richness"),
    c("log_total_abundance", "log_chao_richness")),
  ~ get_ratio(exp(pred_hft9309_t0_dec[[.x]]$val), r = 0)
)

other_hft9309_0_dec_by2 <- map_chr(
  setNames(names(pred_number$pred_hft9309_t0), names(pred_number$pred_hft9309_t0))[
    !names(pred_number$pred_hft9309_t0) %in% c("log_chao_richness",
      "log_total_abundance")],
  ~ get_ratio(pred_hft9309_t0_dec[[.x]]$val, r = 0)
  )
```

```{r}
pred_rivstr_t0 <- map(
  setNames(names(pred_number$pred_rivstr_t0), names(pred_number$pred_rivstr_t0)),
  ~extract_pred(
    x = pred_number$pred_rivstr_t0,
    resp = .x,
    val_to_extract = c("min", "max")
  )
)

abun_rich_riv_int_max <- map_chr(
  setNames(c("log_total_abundance", "log_chao_richness"),
    c("log_total_abundance", "log_chao_richness")),
  ~ get_ratio(exp(pred_rivstr_t0[[.x]]$val), r = 0)
)
other_riv_int_max <- map_chr(
  setNames(names(pred_number$pred_rivstr_t0), names(pred_number$pred_rivstr_t0))[
    !names(pred_number$pred_rivstr_t0) %in% c("log_chao_richness",
      "log_total_abundance")],
  ~ get_ratio(pred_rivstr_t0[[.x]]$val, r = 0)
  )
```


```{r}
pred_hft93_t10 <- map(
  setNames(names(pred_number$pred_hft93_t10), names(pred_number$pred_hft93_t10)),
  ~extract_pred(
    x = pred_number$pred_hft93_t10,
    resp = .x,
    val_to_extract = c("intact", "max")
  )
)

abun_rich_hft93_int_max_t10 <- map_chr(
  setNames(c("log_total_abundance", "log_chao_richness"),
    c("log_total_abundance", "log_chao_richness")),
  ~ get_ratio(exp(pred_hft93_t10[[.x]]$val), r = 0)
)
other_hft93_int_max_t10 <- map_chr(
  setNames(names(pred_number$pred_hft93_t10), names(pred_number$pred_hft93_t10))[
    !names(pred_number$pred_hft93_t10) %in% c("log_chao_richness",
      "log_total_abundance")],
  ~ get_ratio(pred_hft93_t10[[.x]]$val, r = 0)
  )
```

```{r}
pred_hft9309_t10 <- map(
  setNames(names(pred_number$pred_hft9309_t10), names(pred_number$pred_hft9309_t10)),
  ~extract_pred(
    x = pred_number$pred_hft9309_t10,
    resp = .x,
    val_to_extract = c("div/2", "inc/2")
  )
)

abun_rich_hft9309_0_inc_by2_t10 <- map_chr(
  setNames(c("log_total_abundance", "log_chao_richness"),
    c("log_total_abundance", "log_chao_richness")),
  ~ get_ratio(exp(pred_hft9309_t10[[.x]]$val), r = 0)
)
other_hft9309_0_inc_by2_t10 <- map_chr(
  setNames(names(pred_number$pred_hft9309_t10), names(pred_number$pred_hft9309_t10))[
    !names(pred_number$pred_hft9309_t10) %in% c("log_chao_richness",
      "log_total_abundance")],
  ~ get_ratio(pred_hft9309_t10[[.x]]$val, r = 0)
  )
```


## Community changes over space

Our dataset comprised 4476 riverine fish community timeseries that have been
repeatedly sampled over the last decades (baseline: `r tss$min`;
span: `r tss$span` years; completeness:`r tss$completeness`; median [25th
quantile,75th quantile]), mainly in Western and Northern Europe, Northern
Eastern America, South Eastern Australia and Japan
from the RivFishTime database[@comte_rivfishtime_2021] and additional monitoring
programs (Table S1, Fig. S1). We derived estimates of community changes and its
drivers from a hierarchical Bayesian model including hydrographic basin and the
sites, nested in basin. We quantified anthropogenic pressures using the human
footprint index, a cumulative index including infrastructures, urbanization and
agricultural land use and population density[@sanderson_human_2002], and which
has been previously related to species extinction and biological invasion
risks[@di_marco_changes_2018; @gallardo_importance_2015]. We quantified the
legacy of past anthropogenic pressures with the human footprint index of 1993,
as only 7% of the monitoring surveys were realized before this date (Fig. S1).
We found strong evidence that higher past anthropogenic pressures resulted in higher
species richness (Fig. 1), as most degraded sites (human footprint index = 
`r round(pred_data_explanation$hft_ix_c93["max"],1)`) have 
`r abun_rich_hft93_int_max["log_chao_richness"]` more species than "intact"
sites (human footprint index = `r round(pred_data_explanation$hft_ix_c93["intact"],1)`).
Sites subject to higher past anthropogenic pressures also had a higher
proportion of non-native richness and non-native abundance (strong evidence,
Fig. 1), such as the most degraded sites had a proportion of non-native species
richness (`r scales::percent(pred_hft93_t0$perc_exo_sp$val["max"])`) twice
higher than intact sites (`r scales::percent(pred_hft93_t0$perc_exo_sp$val["intact"])`)
and a proportion of non-native species abundance three times higher 
(`r scales::percent(pred_hft93_t0$perc_exo_abun$val["max"])` and
`r scales::percent(pred_hft93_t0$perc_exo_abun$val["intact"])` resp.). 
We found also strong evidence that higher past anthropogenic pressures resulted in
lower total abundance (Fig. 1), such as most degraded sites had a total abundance
`r abun_rich_hft93_int_max["log_total_abundance"]` lower than intact sites. In
contrast, we found strong evidence that recent increases in anthropogenic
pressures, quantified by the ratio of the human footprint index
between 2009 and 1993, was associated with communities displaying on average
lower species richness and total abundance. Sites that have been subject to a
recent twofold increase in anthropogenic had a species richness
`r abun_rich_hft9309_0_inc_by2["log_chao_richness"]` and a total abundance 
`r abun_rich_hft9309_0_inc_by2["log_total_abundance"]` lower compared to site
that have not undergone recent changes in antropogenic pressures. We also
found strong evidence that sites that have undergone recent twofold increase in
anthropogenic pressures had a proportion of non-native species richness and
abundance half higher (resp.  +`r other_hft9309_0_inc_by2["perc_exo_sp"]` and 
+`r other_hft9309_0_inc_by2["perc_exo_abun"]`) than sites that have not changed
recently in anthropogenic pressures. We found strong evidence that stream
gradient, synthetized by a PCA axis related to strahler order, distance from
source, and annual discharge, modulate species richness and non-exotic species
presence, most downstream sites having three times more species than most
upstream streams, as well as a proportion in non-native species richness and
abundance respectively `r other_riv_int_max["perc_exo_sp"]` and 
`r other_riv_int_max["perc_exo_abun"]` higher.


## Global community changes over time

We derived global temporal trends from a model without anthropogenic drivers.
We found an overall increase  in species richness and total abundance, together
with strong reorganization in community composition. More specifically, our
results indicated strong evidence for a global increase over time in total
abundance  (Credible Interval 95%: `r abun_trends` by decade) and in species
richness (CI 95%: `r rich_trends` by dec.). We further found moderate evidence
for a global decline in the proportion of non-native species abundance of (CI
90%: `r exo_trends[["perc_exo_abun"]]` by dec.), but no evidence for a net
temporal trend in the proportion of non-native species richness (CI 80%: 
`r exo_trends[["perc_exo_sp"]]` by dec.). We found strong evidence that
community composition changes fast, with one third of the species changes 
after a decade (jaccard dissimilarity, CI 95%: `r jac_trends` by dec.), and we
found rougly similar trends for Simpson dissimilarity index, which is based on
species relative abundance. Turnover, which describes composition changes arising from species
replacement, and nestedness, describing changes arising from species gains and
losses from a common pool, displayed a comparable increase over time  (CI 95%:
`r tu_trends` by dec), corresponding to an equal share from the rate of increase
of the Jaccard dissimilarity index (Fig. SXX). Together, it indicates that
composition changes were related to changes in species richness and species
identity but also changes in dominance structure, i.e. changes in the identity
of the dominant species.

## Effect of anthropogenic pressures on community changes over time


```{r}
hft93abun <- get_effect_ci(resp = "log_total_abundance", ci_lvl = "level:0.95", term = "log1_year_nb:hft_ix_c93")
hft93rich <- get_effect_ci(resp = "log_chao_richness", ci_lvl = "level:0.95", term = "log1_year_nb:hft_ix_c93")
hft93exor <- get_effect_ci(resp = "perc_exo_sp", ci_lvl = "level:0.80", term = "log1_year_nb:hft_ix_c93")
hft93exoa <- get_effect_ci(resp = "perc_exo_abun", ci_lvl = "level:0.80", term = "log1_year_nb:hft_ix_c93")
hft93hill <- get_effect_ci(resp = "hillebrand_dis_scaled", ci_lvl = "level:0.95", term = "log1_year_nb:hft_ix_c93")
hft93turn <- get_effect_ci(resp = "turnover_scaled", ci_lvl = "level:0.95", term = "log1_year_nb:hft_ix_c93")
```

We found strong evidence that past anthropogenic pressures increased the
temporal trends of total abundance and species richness (resp. CI95%:$\beta\prime =$ 
`r hft93abun` and `r hft93rich`, Fig. 1). We also found weak evidence that past
anthropogenic pressures increased the proportion of non-native richness over
time (CI 80%:$\beta\prime =$ `r hft93exor`, Fig. 1), but no evidence that they
affect the proportion of non-native abundance (CI 80%:$\beta\prime =$
`r hft93exoa`, Fig. 1). We also found strong evidence that past anthropogenic
pressures increased temporal dissimilarity and turnover over time, i.e. respectively
indicating changes in species dominance and species replacement (resp. CI
95%:$\beta\prime =$ `r hft93hill` and `r hft93turn`).


```{r}
hft09abun <- get_effect_ci(resp = "log_total_abundance", ci_lvl = "level:0.80", term = "log1_year_nb:hft_ix_c9309_log2_ratio", r = 3)
hft09rich <- get_effect_ci(resp = "log_chao_richness", ci_lvl = "level:0.80", term = "log1_year_nb:hft_ix_c9309_log2_ratio", r = 3)
hft09exor <- get_effect_ci(resp = "perc_exo_sp", ci_lvl = "level:0.90", term = "log1_year_nb:hft_ix_c9309_log2_ratio", r = 2)
hft09exoa <- get_effect_ci(resp = "perc_exo_abun", ci_lvl = "level:0.80", term = "log1_year_nb:hft_ix_c9309_log2_ratio", )
hft09hill <- get_effect_ci(resp = "hillebrand_dis_scaled", ci_lvl = "level:0.95", term = "log1_year_nb:hft_ix_c9309_log2_ratio")
hft09turn <- get_effect_ci(resp = "turnover_scaled", ci_lvl = "level:0.95", term = "log1_year_nb:hft_ix_c9309_log2_ratio")
```

We did not found evidence for an effect of recent anthropogenic
pressures on the temporal trends of both total abundance and species richness
(resp. CI 80%: $\beta\prime =$ `r hft09abun` and `r hft09rich`, Fig. 1). However, we found
moderate evidence that recent increase in anthropogenic pressures increase
the proportion in non-native richness over time (CI 90%: $\beta\prime =$ `r hft09exor`,
Fig. 1) but not the proportion of non-native abundance (CI 80%: $\beta\prime =$
`r hft09exoa`, Fig. 1). We found also strong evidence that recent increase in
anthropogenic pressures resulted in stronger temporal dissimilarity and turnover 
(resp. CI 95%: $\beta\prime =$ `r hft09hill` and `r hft09turn`, Fig. 1).

```{r}
hft2abun <- get_effect_ci(resp = "log_total_abundance", ci_lvl = "level:0.95",
  term = "log1_year_nb:hft_ix_c93:hft_ix_c9309_log2_ratio", r = 3)
hft2rich <- get_effect_ci(resp = "log_chao_richness", ci_lvl = "level:0.80",
  term = "log1_year_nb:hft_ix_c93:hft_ix_c9309_log2_ratio", r = 3)
hft2exor <- get_effect_ci(resp = "perc_exo_sp", ci_lvl = "level:0.90",
  term = "log1_year_nb:hft_ix_c93:hft_ix_c9309_log2_ratio", r = 3)
hft2exoa <- get_effect_ci(resp = "perc_exo_abun", ci_lvl = "level:0.80",
  term = "log1_year_nb:hft_ix_c93:hft_ix_c9309_log2_ratio")
hft2hill <- get_effect_ci(resp = "hillebrand_dis_scaled", ci_lvl = "level:0.95",
  term = "log1_year_nb:hft_ix_c93:hft_ix_c9309_log2_ratio")
hft2turn <- get_effect_ci(resp = "turnover_scaled", ci_lvl = "level:0.95",
  term = "log1_year_nb:hft_ix_c93:hft_ix_c9309_log2_ratio")
```

We also found strong evidence for antagonistic effect between past and recent
changes in anthropogenic pressures on the temporal trends of total abundance (CI
95%: $\beta\prime =$ `r hft2abun`, Fig.1), meaning that recent anthropogenic
pressures decreased more temporal trends of total abundance in sites that were
previously more degraded.  We did not find evidence for such interaction for
species richness (CI 80%: $\beta\prime =$ `r hft2rich`, Fig. 1). In constrast,
we found moderate evidence for a synergistic effect between past and recent
anthropogenic pressures on the increase of the proportion of non-native species,
but not of non-native abundance (resp. CI 90%: $\beta\prime =$ `r hft2exor` and
CI 80% `r hft2exoa`, Fig.1). Finally, we found strong evidence for a synergistic
between past and recent anthropogenic pressures on the increase of temporal
dissimilarity and turnover (resp. CI 95%: $\beta\prime =$ `r hft2hill`
and `r hft2turn`, Fig.1).

## Effect of the stream gradient on community changes over time 

```{r}
rivhftabun <- get_effect_ci(resp = "log_total_abundance", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c93", r = 3)
rivhftrich <- get_effect_ci(resp = "log_chao_richness", ci_lvl = "level:0.90",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c93", r = 4)
rivhftexor <- get_effect_ci(resp = "perc_exo_sp", ci_lvl = "level:0.90",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c93", r = 3)
rivhftexoa <- get_effect_ci(resp = "perc_exo_abun", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c93", r = 3)
rivhfthill <- get_effect_ci(resp = "hillebrand_dis_scaled", ci_lvl = "level:0.80",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c93", r = 3)
rivhftturn <- get_effect_ci(resp = "turnover_scaled", ci_lvl = "level:0.80",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c93", r = 3)

rivhft09abun <- get_effect_ci(resp = "log_total_abundance", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c9309_log2_ratio", r = 3)
rivhft09rich <- get_effect_ci(resp = "log_chao_richness", ci_lvl = "level:0.90",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c9309_log2_ratio", r = 4)
rivhft09exor <- get_effect_ci(resp = "perc_exo_sp", ci_lvl = "level:0.80",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c9309_log2_ratio", r = 3)
rivhft09exoa <- get_effect_ci(resp = "perc_exo_abun", ci_lvl = "level:0.90",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c9309_log2_ratio", r = 3)
rivhft09hill <- get_effect_ci(resp = "hillebrand_dis_scaled", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c9309_log2_ratio")
rivhft09turn <- get_effect_ci(resp = "turnover_scaled", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1:hft_ix_c9309_log2_ratio")
```

```{r}
riv1abun <- get_effect_ci(
  resp = "log_total_abundance", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1", r = 2)
riv1rich <- get_effect_ci(resp = "log_chao_richness", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1", r = 2)
riv1exor <- get_effect_ci(resp = "perc_exo_sp", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1", r = 2)
riv1exoa <- get_effect_ci(resp = "perc_exo_abun", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1", )
riv1hill <- get_effect_ci(resp = "hillebrand_dis_scaled", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1")
riv1turn <- get_effect_ci(resp = "turnover_scaled", ci_lvl = "level:0.95",
  term = "log1_year_nb:riv_str_rc1")
```

We found strong evidence that the stream gradient, from upstream to downstream,
increased the temporal trends of both total abundance and species
richness (resp. CI 95%: $\beta\prime =$ `r riv1abun` and `r riv1rich`, Fig. 1).
Furthermore, there was strong evidence that the increase of the proportion of
non-native species richness and abundance over time are higher downstream than upstream 
(resp. CI 95%: $\beta\prime =$ `r riv1exor` and `r riv1exoa`, Fig. 1).
Conjointly, we found strong evidence that the stream gradient increased temporal
dissimilarity and turnover (resp. CI 95%: $\beta\prime =$ `r riv1hill` and `r riv1turn`,
Fig. 1). We also found that past and recent changes in anthropogenic pressures
interact with the stream gradient. We found that both past and recent changes in
anthropogenic pressures have a synergistic effect on the increase of the
proportion of non-native species richness (resp. CI 90%: $\beta\prime =$ `r rivhftexor` and
CI 80%: $\beta\prime =$ `r rivhft09exor`, Fig. 1), and  of non-native species
abundance (resp. CI 95%: $\beta\prime =$ `r rivhftexoa` and
CI 90%: $\beta\prime =$ `r rivhft09exoa`, Fig. 1). In contrast, we found
evidence that stream gradient have an antagonistic effect with past
anthropogenic pressures on both on species richness and total abundance temporal
trends (resp. CI 95%: $\beta\prime =$ `r rivhftrich` and CI 80%: $\beta\prime =$
`r rivhftabun`, Fig. 1), meaning that the positive effect of past anthropogenic
pressures on species richness and total abundance temporal trends are lower
downstream than upstream. We found moderate evidence that stream gradient has a
antagonistic effect with recent increase in anthropogenic pressures on the
temporal trends of species richness (resp. CI 90%: $\beta\prime =$
`r rivhft09rich`), but we found no effects on total abundance. In contrast, we
found no evidence that both past and recent changes in anthropogenic pressures
have an interacting effect with the stream gradient on temporal dissimilarity
and turnover. 

## Typology of community temporal trends

There was a strong heterogeneity among the temporal trends in the different
community metrics as illustrated by the principal component analysis. We found
that the first axis was related to temporal changes in community composition,
i.e. dissimilarity and turnover, while the second axis was related to the
temporal trends in species richness and total abundance (Fig. 2). The third axis
was related to opposite temporal trends in species richness and in total
abundance and the fourth axis was related to opposite temporal trends in
temporal dissimilarity and turnover.  We further derived six distinct
types of community trajectories from the sites temporal trends by using a k-mean
trimmed clustering method. Around 40% of the sites were attributed to a cluster
associated with medium temporal increases in species richness and total
abundance, as well as medium temporal trends in dissimilarity and turnover (Fig.
2). The second cluster (16% of the sites) was related to communities displaying
a high turnover but moderate increases in species richness, total abundance and
dissimilarity over time. The third, fourth and fifth clusters (resp. 13%, 12%
and 9% of the sites, Fig. 2) were related to an increase in species richness
over time, to a decline in total abundance and to a decline in species richness
over time, respectively. The last cluster (7% of the sites) was related to
relatively stable communities over time.  Importantly, the different community
trajectories were observed across all biogeographic realms with similar
frequencies but showed basin-specific patterns (Fig. 3). For instance, the
Potamac basin (US, Fig. 3c) displayed with relatively few sites corresponding to
declines in total abundance but much higher proportion of sites displaying
strong turnover, i.e. species replacement.  We also found that Thames basin
(UK, Fig. 3d) displayed higher proportion of sites corresponding to a decrease
in species richness and total abundance but low proportion corresponding to low
community changes. We further found that for all community metrics, the variance
in the temporal trends, was higher for the site identity (nested in basin) than
for hydrographic basin. Expect for total abundance and species richness, the
variance attributed to site was at least twice higher than the one attributed to
basin (Table 1).

# Discussion

Our results suggests that both past and recent anthropogenic pressures leave a
strong spatial imprint on riverine fish communities. The most degraded sites in
the past had an proportion of non-native species and abundance two times and
three times higher than "intact" sites, in line with findings that higher
density of human population, urban areas and roads, all present in the human
footprint index, increase non-native richness by increasing propagule
pressure[@anas_drivers_2021; @leprieur_fish_2008; @bernery_freshwater_2022].
Anthropogenic pressures can further increase the establishment success of
non-native species by modifying environmental conditions, creating new niche
opportunities, in a way that native species loose their prior competitive
advantage due to local adaptation over the non-native[@bernery_freshwater_2022;
@byers_impact_2002; @olden_life-history_2006]. It suggests that the higher
species richness found in sites more degraded in the past is partly related to
the higher share of non-natives, as non-native introductions is higher than
native extirpation in Nearctic and Palearctic
realms[@villeger_homogenization_2011], which should result in higher overall
species richness. However, both past and recent increase in anthropogenic
pressures resulted in a lower total abundance, in accordance with the abundant
literature showing that land degradation have detrimental effects on the total
abundance and species richness of terrestrial vertebrates and
invertebrates[@newbold_global_2015; @outhwaite_agriculture_2022]. 

The global increase in species richness and total abundance over time,
accompanied by a strong species replacement and changes in dominant species,
suggest important ongoing changes in fish riverine communities. Interestingly,
the global increase of 13% in total abundance by decade found in this study,
closely match the 11% per decade reported for freshwater
insects[@van_klink_meta-analysis_2020]. Is is also consistent with other
regional assessments of freshwater animal populations, the reported
increase in freshwater insect occupancy found in the UK and increase in
freshwater animal LPI (Living Planet Index) in Netherlands since the
1990s[@outhwaite_complex_2020; @van_strien_modest_2016], but contrasts with
dramatic LPI declines of freshwater megafauna reported at
worldwide scale[@he_global_2019] and with regional assessments of fish
assemblages[@moraga_century_2022]. The global increase in fish species richness over time
contrasts with the absence of net changes reported across terrestrial
and marine assemblages[@vellend_global_2013; @dornelas_assemblage_2014;
@blowes_geography_2019]. Higher past anthropogenic pressures resulted in a
larger increase in species richness and total abundance over time, suggesting an
increase from the legacy of past disturbances. Previous studies suggested that
the adoption of numerous legislations targeting improvements in freshwater water
quality in EU and US since 1970s and a decline of the negative effects from
agriculture over time could be partly responsible for those increase despite
habitat degradation[@langford_long-term_2009; @van_klink_meta-analysis_2020;
@outhwaite_agriculture_2022]. Most of our monitored sites (92%) could
be considered in an initial state of degradation at the beginning of the study
period, i.e. had a human footprint index superior to four in
1993[@williams_change_2020], could therefore lend support to the recovery
hypothesis. 

However, higher past anthropogenic pressures resulted in a greater increasing
share of non-native species over time, which suggests that non-native species
contributes disproportionately to the increase in species richness estimated
over time in riverine fish communities. Then, the increase of local species
richness over time could result from the differential between introduction and
extirpation from on-going spatial homogenization[@villeger_homogenization_2011],
as predicted by metacommunity models[@mouquet_community_2003]. By contrast, past
anthropogenic pressures had no effect on the share of non-native species
abundance over time while had a positive one over space, which might be due to
the residential time needed between introduction and
establishment[@bernery_freshwater_2022]. Established non-native species were
shown to be mostly ubiquitous and generalists species[@tonella_importance_2018;
@su_morphological_2020], with extreme morphological and traits that
disproportionately increase functional richness and divergence in fish riverine
communities[@toussaint_non-native_2018]. Past anthropogenic pressures also
resulted in higher rates of species replacement and changes in species dominance
over time, in accordance with findings that non-native species play an important
role in temporal dissimilarity and turnover in fish riverine
communities[@toussaint_historical_2014; @kuczynski_concomitant_2018]. Changes in
dominance are predicted to alter species interactions, coexistence among species
and ultimately ecosystem functioning[@hillebrand_consequences_2008]. Taken
together, our results suggest that the legacy of past degradation lead to
an ongoing adaptation to degraded environments, with a disproportionate
contribution of non-native species, accompanied by large species replacement and
changes in dominant species identity. However, a more definitive interpretation
of those increases in species richness and total abundance in freshwater systems
would require a precise assessment of habitat quality and of the tolerance of
the species composing the communities in these areas in an degraded state, as
native tolerant species might also contribute to on-going changes[@mccune_gains_2013].

In contrast, recent addition in anthropogenic pressure decreases the temporal
trends of species richness and total abundance, particularly in location of
higher past degradation. It suggests that the increase in species richness and
abundance from high past anthropogenic pressures was not happening in the sites
that continued to experience an increase in anthropogenic pressures. A reason
might be that we considered recent changes in anthropogenic pressures as
multiplicative, i.e. using a ratio, such as sites having high anthropogenic pressures in the past
had an higher absolute increase in anthropogenic pressures than sites having
lower pressures in the past. In contrast, past and recent increase in
anthropogenic pressures have additive and synergistic effects on increasing the
proportion of non-native species richness over time, on increasing temporal
dissimilarity both in term of changes in dominance and species replacement. All
together, our results highlight that considering the timing of anthropogenic
pressures[@mccomb_editorial_2020; @brooks_combined_2019;@orr_towards_2020] and
the species identity and role is crucial to better understanding community
changes over space and time.

Community changes over time lied in different dimensions that we attempted to
regroup in different trajectory complexes, i.e. changes in species richness,
total abundance, turnover or medium/low community changes over time.  Our result
in are in accordance with findings that temporal changes in composition are
poorly related to temporal trends in species richness[@dornelas_assemblage_2014;
@blowes_geography_2019; @hillebrand_biodiversity_2018; @chase_embracing_2018].
Furthermore, our results suggest that community changes are more heterogeneous
at local scale than at the basin and realm scale, as indicated higher variance
in temporal trends found at the site scale than at the basin scale and the
relative homogeneous distribution of cluster across realms. It might be a
characteristic of riverine systems, which are highly constrained by the stream
gradient and by basin limits, which in turn determine environmental filtering
and potential of dispersal [ref]. Our results suggests the spatial distribution
in anthropogenic pressures and their timing constitutes another layer adding to
the high heterogeneity of community changes at local scale. The random
intercepts of the hierarchical model, related to the spatial scale, captured
much more variance in the community metrics than the fixed effects. It could be
related to biogeographic factors related to post-glaciation fish colonization,
climatic factors, and physical barriers which further explains species
composition differences among fish riverine communities[@abell_freshwater_2008;
@villeger_homogenization_2011]. It might also be related to a too coarse spatial
resolution of anthropogenic pressures and its synthetic nature, which explains
only a part of the variance in community metrics.

Our study uncovered the relationships between community changes and
anthropogenic pressures in riverine fish communities over space and time.  Our
result suggests that recent increase in species richness and total abundance
over time might be related to on-going homogenization of fish riverine
communities as indicated by the increasing share of non-native species.  This
interpretation is supported by previous findings[@leprieur_fish_2008;
@villeger_homogenization_2011; @toussaint_historical_2014;
@kuczynski_concomitant_2018], suggesting that water quality improvement might
not be the main driver of recent increases in freshwater systems. Our study also
highlights the strong legacy of human pressure on species richness, total
abundance, and share of non-native species in fish riverine communities. Our
study has a spatial coverage limited to historically industrialized countries,
whereas the highest recent increase in anthropogenic pressures happened in
current biodiversity hotspots. Our results suggest that they result in more
dramatic community changes, in line with previous findings[@he_global_2019;
@leprieur_fish_2008]. Our study confirms that community changes over time are
multidimensional and spatially heterogeneous, drove in part by the heterogeneity
of human pressures over space in time. Human pressures have also antagonistic
effects on species richness and abundance, as ecosystem degradation should lead
to local extinction while propagule pressure should lead to local colonization
and regional homogenization. Further promising investigations include the
assessment of the potentially interacting effects between anthropogenic
pressures and climate change[@comte_climate_2021; @outhwaite_agriculture_2022;
@reid_emerging_2019], further considering the characteristics of the species
driving community changes[@su_morphological_2020]. Our study further confirms
that linking local community changes to reported on-going community
homogenization at regional scale is crucial to understand why reported local
gains and global declines in biodiversity are not
contradictory[@vellend_plant_2017; @primack_biodiversity_2018;
@mcgill_fifteen_2015].

# References {-}

<div id="refs"></div>
